# Lambda demo: Push a Lambda via Serverless to AWS

This demo shows, how to deploy a [AWS Lambda](https://aws.amazon.com/lambda/?nc1=h_ls) in Python via the [Serverless framework](https://serverless.com). One major benefit of Serverless comes up with its compatibility with more than one private cloud provider. Following this guide will publisch a HelloWorld function by default. Other examples are given in this repository.

## Prepare Serverless
1. Install NodeJS and npm.
2. Install serverless itself: 

```bash 
npm install -g serverless
```

## Create your Serverless environment
1. Change name and path accordingly:
    ```bash 
    serverless create \
    --template aws-python3 \
    --name ServerlessDemo \
    --path ServerlessDemo
    ```

2. Move to your directory, generate a venv for Python and activate it.
    ```bash
    cd ServerlessDemo
    virtualenv venv --python=python3
    source venv/bin/activate
    ```

3. Two files are already generated by `serverless` for you:
    1. handler.py
    2. serverless.yml

4. Change the contet of handler.py accordingly or leave it as default (HelloWorld example). Don't forget to install Python packages as needed.

5. If needed, save the requirements: 
    ```bash 
    pip freeze > requirements.txt
    ````
    A little warning: If you need severel Python packages like **numpy** or **pandas**, you should use [Lambdas Layer feature](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html). Otherwise, the upload will be terminated due to service limits as well as your Lambda gets lazy.

6. Edit serverless.yml: 

    ```bash 
    nano serverless.yml
    ````

    The file [serverless.yml](https://github.com/Zirkonium88/AWS/blob/master/Lambda/ServerlessDemo/serverless.yml) can be used to set staging of your deployment, the region, IAM ressources and many more.

    ```yaml
    service: ServerlessDemo # NOTE: update this with your service name

    provider:
    name: aws 
    runtime: python3.6 
    stage: dev
    region: eu-central-1

    functions:
    ServerlessDemo: # Global name; remember it for calling your Lambda
        handler: handler.lambda_handler # name of your function

    plugins:
        - serverless-python-requirements

    custom:
        pythonRequirements:
            dockerizePip: non-linux

    # Find more options under: https://serverless.com/framework/docs/providers/aws/guide/
    ```

7. Initiate everything:
    ```bash
    npm init -y
    npm install --save serverless-python-requirements
    ```

8. Test your Lambda (with a sample event). Sample events can retrieved from [AWS documentation](https://docs.aws.amazon.com/AmazonS3/latest/dev/notification-content-structure.html). 

    ```bash
    sls invoke local -f FUNCTION_NAME (-p SAMPLE_EVENT)
    ```

9. Deploy your Lambda to AWS <br/>
    ```bash
    sls deploy
    ```

10. Test your Lambda on AWS: 
    ```bash
    sls invoke -f FUNCTION_NAME (-p SAMPLE_EVENT)
    ````


